<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhiskerMeal - AI Assistant</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body {
            background-color: white;
            font-family: Arial, sans-serif;
            color: #341536;
            height: 100vh;
        }

        /* Navigation */
        .navbar {
            background-color: #341536;
            padding: 10px 0;
        }

        .navbar-brand {
            color: white !important;
            font-size: 24px;
            font-weight: bold;
        }

        .back-btn {
            color: white;
            text-decoration: none;
            font-size: 18px;
            margin-right: 20px;
        }

        .back-btn:hover {
            color: #ADEBB3;
            text-decoration: none;
        }

        /* Chat Container */
        .chat-container {
            height: calc(100vh - 60px);
            margin-top: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat {
            width: 100%;
            max-width: 600px;
            height: 80vh;
        }

        .card {
            height: 100%;
            border: 2px solid #ADEBB3;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(52, 21, 54, 0.1);
        }

        /* Chat Header */
        .msg_head {
            background-color: #341536;
            color: white;
            border-radius: 13px 13px 0 0;
            padding: 15px;
        }

        .user_img {
            width: 50px;
            height: 50px;
            border: 2px solid #ADEBB3;
        }

        .online_icon {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: #28a745;
            border-radius: 50%;
            bottom: 0;
            right: 0;
            border: 2px solid white;
        }

        .img_cont {
            position: relative;
            height: 50px;
            width: 50px;
        }

        .user_info {
            margin-left: 15px;
        }

        .user_info span {
            font-size: 20px;
            font-weight: bold;
            color: #ADEBB3;
        }

        .user_info p {
            font-size: 14px;
            margin: 0;
            opacity: 0.9;
        }

        /* Messages Area */
        .msg_card_body {
            overflow-y: auto;
            height: calc(100% - 140px);
            padding: 20px;
            background-color: #f8f9fa;
        }

        .msg_cotainer {
            background-color: rgba(173, 235, 179, 0.8);
            border: 2px solid #ADEBB3;
            border-radius: 15px 15px 15px 5px;
            padding: 12px 15px;
            margin-left: 10px;
            position: relative;
            max-width: 80%;
        }

        .msg_cotainer_send {
            background-color: rgba(52, 21, 54, 0.8);
            color: white;
            border: 2px solid #341536;
            border-radius: 15px 15px 5px 15px;
            padding: 12px 15px;
            margin-right: 10px;
            position: relative;
            max-width: 80%;
        }

        .msg_time {
            position: absolute;
            left: 0;
            bottom: -15px;
            color: #666;
            font-size: 10px;
        }

        .msg_time_send {
            position: absolute;
            right: 0;
            bottom: -15px;
            color: #666;
            font-size: 10px;
        }

        .img_cont_msg {
            height: 40px;
            width: 40px;
        }

        .user_img_msg {
            height: 40px;
            width: 40px;
            border: 2px solid #ADEBB3;
        }

        /* Message Input */
        .card-footer {
            border-top: 2px solid #ADEBB3;
            background-color: white;
            padding: 15px;
            border-radius: 0 0 13px 13px;
        }

        .type_msg {
            border: 2px solid #e9ecef;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 16px;
        }

        .type_msg:focus {
            border-color: #ADEBB3;
            box-shadow: 0 0 0 0.2rem rgba(173, 235, 179, 0.25);
        }

        .send_btn {
            background-color: #341536;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .send_btn:hover {
            background-color: #4a1f3f;
            transform: scale(1.05);
        }

        .input-group-append {
            margin-left: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .chat-container {
                padding: 10px;
                height: calc(100vh - 50px);
                margin-top: 50px;
            }
            
            .chat {
                height: 90vh;
            }
            
            .msg_cotainer,
            .msg_cotainer_send {
                max-width: 90%;
            }
        }

        /* Scrollbar Styling */
        .msg_card_body::-webkit-scrollbar {
            width: 6px;
        }

        .msg_card_body::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .msg_card_body::-webkit-scrollbar-thumb {
            background: #ADEBB3;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar fixed-top">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <a href="homepage.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
                <a class="navbar-brand">ðŸ¤– WhiskerMeal AI Assistant</a>
            </div>
        </div>
    </nav>

    <!-- Chat Container -->
    <div class="chat-container">
        <div class="chat">
            <div class="card">
                <div class="card-header msg_head">
                    <div class="d-flex bd-highlight">
                        <div class="img_cont">
                            <img src="https://i.ibb.co/fSNP7Rz/icons8-chatgpt-512.png" class="rounded-circle user_img">
                            <span class="online_icon"></span>
                        </div>
                        <div class="user_info">
                            <span>PetBot Assistant</span>
                            <p>Ask me anything about pet care!</p>
                        </div>
                    </div>
                </div>
                <div id="messageFormeight" class="card-body msg_card_body">
                    <!-- Welcome Message -->
                    <div class="d-flex justify-content-start mb-4">
                        <div class="img_cont_msg">
                            <img src="https://i.ibb.co/fSNP7Rz/icons8-chatgpt-512.png" class="rounded-circle user_img_msg">
                        </div>
                        <div class="msg_cotainer">
                            Hello! I'm PetBot, your AI pet care assistant. I can help you with feeding schedules, health advice, training tips, and WhiskerMeal device support. What would you like to know about your pet today?
                            <span class="msg_time">Just now</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <form id="messageArea" class="input-group">
                        <input type="text" id="text" name="msg" placeholder="Type your message..." autocomplete="off" class="form-control type_msg" required/>
                        <div class="input-group-append">
                            <button type="submit" id="send" class="input-group-text send_btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <script>
        // Pet care Q&A database
        const petQADatabase = {
            // Feeding related questions
            "how much should i feed my dog": "For adult dogs, feed 2-3 meals per day. Generally, 1/4 to 1/2 cup of food per 10 pounds of body weight per meal. Adjust based on your dog's activity level, age, and the food manufacturer's recommendations.",
            "how often should i feed my cat": "Adult cats should be fed 2-3 times per day. Kittens under 6 months need 3-4 meals daily. Most cats do well with 1/4 to 1/2 cup of dry food per meal, depending on their size and activity level.",
            "what time should i feed my pet": "Establish regular feeding times. For dogs: 7 AM and 6 PM works well for twice daily feeding. For cats: morning, midday, and evening. Consistency helps with digestion and creates a routine your pet will love.",
            "my pet won't eat": "Try warming the food slightly, ensuring fresh water is available, and check if the food is expired. If your pet hasn't eaten for 24 hours or shows other symptoms, consult your veterinarian immediately.",
            "can i give my dog human food": "Some human foods are safe like plain rice, chicken, carrots, and green beans. Never give chocolate, grapes, onions, garlic, or xylitol-containing products. When in doubt, stick to pet food designed for your animal's needs.",

            // Health related questions
            "when should i take my pet to the vet": "Annual checkups for healthy adult pets, twice yearly for seniors (7+ years). Immediately for emergency signs: difficulty breathing, severe vomiting/diarrhea, inability to urinate, collapse, or any sudden behavior changes.",
            "what are signs my pet is sick": "Watch for changes in appetite, water consumption, energy levels, bathroom habits, or behavior. Other warning signs include vomiting, diarrhea, lethargy, excessive panting, or hiding. Trust your instincts - you know your pet best.",
            "how do i know if my pet is overweight": "You should be able to feel your pet's ribs without pressing hard. From above, there should be a visible waist. From the side, the belly should tuck up. If unsure, ask your vet to assess your pet's body condition.",
            "my pet is drinking a lot of water": "Increased thirst can indicate diabetes, kidney disease, or other health issues. Monitor for 24-48 hours and contact your vet if it continues, especially if accompanied by increased urination or other symptoms.",

            // Training and behavior
            "how do i train my pet to use the feeder": "Start by placing treats near the device. Feed manually next to the machine for several days. Let your pet explore the device when it's not feeding time. Most pets adapt within a week once they associate it with food.",
            "my pet is eating too fast": "Use a slow-feed bowl, puzzle feeder, or spread food on a flat surface. You can also divide meals into smaller, more frequent portions. Fast eating can cause choking or digestive issues.",
            "how to stop my dog from begging": "Never give food from your plate. Establish clear feeding times and stick to them. Teach the 'place' command during meal times. Consistency from all family members is key.",
            "my cat won't use the litter box": "Ensure the box is clean, in a quiet location, and the right size. Try different litter types. Rule out medical issues with your vet. Sudden changes in litter box habits often indicate health problems.",

            // WhiskerMeal specific
            "how do i set up whiskermeal": "Go to the web, connect to WiFi, create your pet's profile, set feeding schedules, and add food to containers. The setup wizard will guide you through each step. Contact support if you need help.",
            "how to clean whiskermeal": "Clean food and water bowls daily with warm soapy water. Wipe exterior weekly with damp cloth. Monthly, clean internal dispensing mechanism following manual instructions. Always unplug before cleaning.",
            "whiskermeal not working": "Check WiFi connection, restart device by unplugging for 30 seconds, update the app, and ensure food isn't jammed. Contact support at support@whiskermeal.com if problems persist.",
            "how accurate is health prediction": "Our AI analyzes eating patterns, timing, and frequency to detect early warning signs. While helpful for monitoring, always consult your veterinarian for proper diagnosis and treatment of health concerns.",

            // General pet care
            "how often should i bathe my pet": "Dogs: every 4-6 weeks or when dirty/smelly. Cats: rarely needed as they groom themselves. Over-bathing can remove natural oils and cause skin irritation.",
            "what vaccines does my pet need": "Core vaccines for dogs: rabies, DHPP. For cats: rabies, FVRCP. Your vet will recommend additional vaccines based on lifestyle and local disease risks. Keep vaccinations current.",
            "how much exercise does my pet need": "Dogs: 30 minutes to 2 hours daily depending on breed and age. Cats: 10-15 minutes of active play twice daily. Adjust based on your pet's energy level and health status.",
            "my pet has bad breath": "Often indicates dental disease. Provide dental chews, brush teeth regularly, and schedule professional cleanings as recommended by your vet. Bad breath can also signal other health issues."
        };

        // Function to find best answer match
        function findBestAnswer(userMessage) {
            const message = userMessage.toLowerCase();
            
            // Direct keyword matching
            for (const question in petQADatabase) {
                if (message.includes(question.toLowerCase()) || 
                    question.toLowerCase().includes(message) ||
                    message.split(' ').some(word => question.toLowerCase().includes(word) && word.length > 3)) {
                    return petQADatabase[question];
                }
            }
            
            // Keyword-based matching for specific topics
            if (message.includes('feed') || message.includes('food') || message.includes('eat')) {
                return "For feeding advice, I recommend regular meal times and appropriate portions based on your pet's size and age. Would you like specific guidance about how much or how often to feed your pet?";
            }
            
            if (message.includes('sick') || message.includes('health') || message.includes('vet')) {
                return "For health concerns, watch for changes in appetite, energy, or behavior. Contact your veterinarian if symptoms persist or worsen. Regular checkups help catch issues early.";
            }
            
            if (message.includes('train') || message.includes('behavior')) {
                return "Training requires patience and consistency. Use positive reinforcement and establish clear routines. What specific behavior would you like help with?";
            }
            
            if (message.includes('whiskermeal') || message.includes('device') || message.includes('app')) {
                return "For WhiskerMeal support, check your WiFi connection and app updates. Clean the device regularly and follow the setup guide. Contact support@whiskermeal.com for technical issues.";
            }
            
            // Default responses
            const defaultResponses = [
                "I'd be happy to help with your pet care question! Could you provide more specific details about what you're experiencing?",
                "That's an interesting question about pet care. For the most accurate advice, especially regarding health concerns, please consult with your veterinarian.",
                "I'm here to help with general pet care advice. What specific aspect of your pet's care would you like guidance on?",
                "Thanks for your question! While I can provide general guidance, always consult your vet for health-related concerns or specific medical advice."
            ];
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        $(document).ready(function() {
            $("#messageArea").on("submit", function(event) {
                const date = new Date();
                const hour = date.getHours();
                const minute = date.getMinutes().toString().padStart(2, '0');
                const str_time = hour + ":" + minute;
                var rawText = $("#text").val();
                
                var userHtml = '<div class="d-flex justify-content-end mb-4"><div class="msg_cotainer_send">' + rawText + '<span class="msg_time_send">' + str_time + '</span></div><div class="img_cont_msg"><img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg"></div></div>';
                
                $("#text").val("");
                $("#messageFormeight").append(userHtml);
                
                // Auto scroll to bottom
                $("#messageFormeight").scrollTop($("#messageFormeight")[0].scrollHeight);
                
                // Try to get response from local Q&A database first
                setTimeout(function() {
                    var botResponse = findBestAnswer(rawText);
                    var botHtml = '<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="https://i.ibb.co/fSNP7Rz/icons8-chatgpt-512.png" class="rounded-circle user_img_msg"></div><div class="msg_cotainer">' + botResponse + '<span class="msg_time">' + str_time + '</span></div></div>';
                    $("#messageFormeight").append($.parseHTML(botHtml));
                    
                    // Auto scroll to bottom
                    $("#messageFormeight").scrollTop($("#messageFormeight")[0].scrollHeight);
                }, 1000); // 1 second delay to simulate thinking
                
                // Optional: Also try server endpoint (uncomment if you have a backend)
                /*
                $.ajax({
                    data: {
                        msg: rawText,
                    },
                    type: "POST",
                    url: "/get",
                }).done(function(data) {
                    var botHtml = '<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="https://i.ibb.co/fSNP7Rz/icons8-chatgpt-512.png" class="rounded-circle user_img_msg"></div><div class="msg_cotainer">' + data + '<span class="msg_time">' + str_time + '</span></div></div>';
                    $("#messageFormeight").append($.parseHTML(botHtml));
                    
                    // Auto scroll to bottom
                    $("#messageFormeight").scrollTop($("#messageFormeight")[0].scrollHeight);
                }).fail(function() {
                    // Fallback to local Q&A if server fails
                    var botResponse = findBestAnswer(rawText);
                    var botHtml = '<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="https://i.ibb.co/fSNP7Rz/icons8-chatgpt-512.png" class="rounded-circle user_img_msg"></div><div class="msg_cotainer">' + botResponse + '<span class="msg_time">' + str_time + '</span></div></div>';
                    $("#messageFormeight").append($.parseHTML(botHtml));
                    
                    // Auto scroll to bottom
                    $("#messageFormeight").scrollTop($("#messageFormeight")[0].scrollHeight);
                });
                */
                
                event.preventDefault();
            });
        });
    </script>
</body>
</html>